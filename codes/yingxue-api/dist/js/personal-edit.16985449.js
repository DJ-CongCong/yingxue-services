(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["personal-edit"],{"0653":function(e,t,n){"use strict";n("68ef"),n("5c56")},"34e9":function(e,t,n){"use strict";var a=n("ade3"),r=n("3835"),c=n("7a23"),o=n("d282"),i=n("b1d2"),u=Object(o["a"])("cell-group"),l=Object(r["a"])(u,2),s=l[0],b=l[1];t["a"]=s({inheritAttrs:!1,props:{title:String,border:{type:Boolean,default:!0}},setup:function(e,t){var n=t.slots,r=t.attrs;return function(){var t,o=e.title,u=e.border,l=Object(c["j"])("div",Object(c["p"])({class:[b(),Object(a["a"])({},i["c"],u)]},r),[null===(t=n.default)||void 0===t?void 0:t.call(n)]);return o||n.title?Object(c["j"])(c["a"],null,[Object(c["j"])("div",{class:b("title")},[n.title?n.title():o]),l]):l}}})},4056:function(e,t,n){"use strict";n("68ef"),n("cb51"),n("3743"),n("09fe")},4091:function(e,t,n){"use strict";var a=n("7a23"),r=Object(a["T"])("data-v-33cf81f1");Object(a["C"])("data-v-33cf81f1");var c={class:"form"},o={class:"phone-wrapper"},i={class:"phone-input-wrapper"},u=Object(a["j"])("div",{class:"phone-code"},[Object(a["j"])("span",null,"+86")],-1),l={class:"phone-input-body"},s=Object(a["j"])("span",null,"获取验证码",-1),b={key:1,class:"captcha-cd"},p={class:"captcha-wrapper"},f={class:"captcha-input-wrapper"},d={class:"captcha-input-body"};Object(a["A"])();var j=r((function(e,t,n,j,h,O){var m=Object(a["G"])("van-icon"),v=Object(a["G"])("van-button");return Object(a["z"])(),Object(a["g"])("div",c,[Object(a["j"])("div",o,[Object(a["j"])(m,{class:"icon",name:"contact",size:"28",color:"#555555"}),Object(a["j"])("div",i,[u,Object(a["j"])("div",l,[Object(a["j"])("label",null,[Object(a["R"])(Object(a["j"])("input",{class:"phone-input",type:"text",placeholder:"手机号",maxlength:"11","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.form.phone=t})},null,512),[[a["N"],e.form.phone]])]),0===e.generateCaptchaCD?(Object(a["z"])(),Object(a["g"])("div",{key:0,class:"captcha-button",onClick:t[2]||(t[2]=function(){return e.handleCaptchaClick.apply(e,arguments)})},[s])):(Object(a["z"])(),Object(a["g"])("div",b,[Object(a["j"])("span",null,Object(a["K"])(e.generateCaptchaCD)+"s后重发",1)]))])])]),Object(a["j"])("div",p,[Object(a["j"])(m,{class:"icon",name:"comment-o",size:"28",color:"#555555"}),Object(a["j"])("div",f,[Object(a["j"])("div",d,[Object(a["j"])("label",null,[Object(a["R"])(Object(a["j"])("input",{class:"captcha-input",type:"text",placeholder:"验证码","onUpdate:modelValue":t[3]||(t[3]=function(t){return e.form.captcha=t})},null,512),[[a["N"],e.form.captcha]])])])])]),Object(a["j"])(v,{class:"submit-button",type:"primary",size:"large",onClick:e.handleSubmit},{default:r((function(){return[Object(a["i"])(Object(a["K"])(e.submitText),1)]})),_:1},8,["onClick"])])})),h=(n("e7e5"),n("d399")),O=(n("96cf"),n("1da1")),m=(n("66b9"),n("b650")),v=(n("c3a6"),n("ad06")),g=n("f977");function y(e){return Object(g["a"])({data:{phone:e},url:"/captchas",method:"POST"})}n("d3b7");function k(e){return new Promise((function(t){setTimeout(t,e)}))}var w=k,C=Object(a["k"])({name:"PhoneForm",props:{submitText:{type:String,required:!1,default:function(){return"注册/登录"}}},components:{VanIcon:v["a"],VanButton:m["a"]},data:function(){return{form:{phone:"",captcha:""},generateCaptchaCD:0}},methods:{handleCaptchaClick:function(){var e=this;return Object(O["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.verifyPhone()){t.next=3;break}return h["a"].fail("手机号格式有误"),t.abrupt("return");case 3:return n=h["a"].loading({message:"加载中...",forbidClick:!0}),t.prev=4,t.next=7,y(e.form.phone);case 7:t.next=14;break;case 9:return t.prev=9,t.t0=t["catch"](4),n.clear(),t.abrupt("return");case 14:return n.clear(),h["a"].success("验证码发送成功"),t.next=18,e.generateCaptchaCountDown();case 18:case"end":return t.stop()}}),t,null,[[4,9]])})))()},handleSubmit:function(){this.verifyPhone()?this.verifyCaptcha()?this.$emit("submit",this.form):h["a"].fail("验证码格式有误"):h["a"].fail("手机号格式有误")},verifyPhone:function(){return/^1[3456789]\d{9}$/.test(this.form.phone)},verifyCaptcha:function(){return/^\d{4}$/.test(this.form.captcha)},generateCaptchaCountDown:function(){var e=this;return Object(O["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.generateCaptchaCD=60,t.next=3,e.$nextTick();case 3:if(0===e.generateCaptchaCD){t.next=11;break}return t.next=6,w(1e3);case 6:return e.generateCaptchaCD--,t.next=9,e.$nextTick();case 9:t.next=3;break;case 11:case"end":return t.stop()}}),t)})))()}}});n("fcc7");C.render=j,C.__scopeId="data-v-33cf81f1";t["a"]=C},"52ae":function(e,t,n){"use strict";n("885a")},"5c56":function(e,t,n){},"66b9":function(e,t,n){"use strict";n("68ef"),n("cb51"),n("3743"),n("e3b3"),n("bc1b")},"885a":function(e,t,n){},"99a7":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("96cf");var a=n("1da1"),r=n("7a23"),c=n("0613");function o(){var e=Object(c["b"])(),t=Object(r["e"])({get:function(){return e.state.user.personal},set:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.dispatch("user/setPersonal",n));case 1:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()}),n=function(){return e.dispatch("user/fetchPersonal")},o=function(){return e.dispatch("user/setPersonal")},i=function(){return e.dispatch("user/cleanPersonal")};return{personal:t,fetchPersonal:n,setPersonal:o,cleanPersonal:i}}},b650:function(e,t,n){"use strict";var a=n("ade3"),r=n("3835"),c=n("7a23"),o=n("d282"),i=n("b1d2"),u=n("b070"),l=n("ad06"),s=n("543e");function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=Object(o["a"])("button"),d=Object(r["a"])(f,2),j=d[0],h=d[1];t["a"]=j({props:p(p({},u["b"]),{},{text:String,icon:String,color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,loadingText:String,loadingType:String,tag:{type:String,default:"button"},type:{type:String,default:"default"},size:{type:String,default:"normal"},nativeType:{type:String,default:"button"},loadingSize:{type:String,default:"20px"},iconPosition:{type:String,default:"left"}}),emits:["click"],setup:function(e,t){var n=t.emit,r=t.slots,o=Object(u["c"])(),b=function(){return r.loading?r.loading():Object(c["j"])(s["a"],{class:h("loading"),size:e.loadingSize,type:e.loadingType,color:"currentColor"},null)},p=function(){return e.loading?b():e.icon?Object(c["j"])(l["a"],{name:e.icon,class:h("icon"),classPrefix:e.iconPrefix},null):void 0},f=function(){var t;if(t=e.loading?e.loadingText:r.default?r.default():e.text,t)return Object(c["j"])("span",{class:h("text")},[t])},d=function(){var t=e.color,n=e.plain;if(t){var a={};return a.color=n?t:i["e"],n||(a.background=t),-1!==t.indexOf("gradient")?a.border=0:a.borderColor=t,a}},j=function(t){e.loading||e.disabled||(n("click",t),o())};return function(){var t=e.tag,n=e.type,r=e.size,o=e.block,u=e.round,l=e.plain,s=e.square,b=e.loading,O=e.disabled,m=e.hairline,v=e.nativeType,g=e.iconPosition,y=[h([n,r,{plain:l,block:o,round:u,square:s,loading:b,disabled:O,hairline:m}]),Object(a["a"])({},i["b"],m)];return Object(c["j"])(t,{type:v,class:y,style:d(),disabled:O,onClick:j},{default:function(){return[Object(c["j"])("div",{class:h("content")},["left"===g&&p(),f(),"right"===g&&p()])]}})}}})},b6aa:function(e,t,n){},bc1b:function(e,t,n){},be7f:function(e,t,n){"use strict";n("68ef"),n("cb51"),n("3743"),n("1a04"),n("1146")},c194:function(e,t,n){"use strict";n("68ef"),n("cb51"),n("3743"),n("1a04")},ebfe:function(e,t,n){"use strict";n.r(t);n("b0c0");var a=n("7a23"),r=Object(a["T"])("data-v-6be09ff6");Object(a["C"])("data-v-6be09ff6");var c={class:"container"},o=Object(a["j"])("span",{style:{"line-height":"64px"}},"头像",-1),i={class:"submit-button-wrapper"},u=Object(a["i"])(" 保存 "),l={class:"phone-form-wrapper"};Object(a["A"])();var s=r((function(e,t,n,s,b,p){var f=Object(a["G"])("nav-bar-icon"),d=Object(a["G"])("van-nav-bar"),j=Object(a["G"])("van-image"),h=Object(a["G"])("van-cell"),O=Object(a["G"])("van-field"),m=Object(a["G"])("van-cell-group"),v=Object(a["G"])("van-button"),g=Object(a["G"])("phone-form"),y=Object(a["G"])("van-overlay");return Object(a["z"])(),Object(a["g"])("div",c,[Object(a["j"])(d,{title:"用户信息",onClickLeft:e.handleBack},{left:r((function(){return[Object(a["j"])(f,{name:"back"})]})),_:1},8,["onClickLeft"]),Object(a["j"])(m,{class:"cell-group-wrapper"},{default:r((function(){return[Object(a["j"])(h,null,{title:r((function(){return[o]})),default:r((function(){return[Object(a["j"])(j,{class:"user-avatar",round:"",width:"64px",height:"64px",src:e.personal.avatar},null,8,["src"])]})),_:1}),Object(a["j"])(O,{modelValue:e.temp.name,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.temp.name=t}),label:"用户名",placeholder:"请输入用户名","input-align":"right"},null,8,["modelValue"]),Object(a["j"])(O,{modelValue:e.temp.intro,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.temp.intro=t}),label:"简介",placeholder:"请输入简介","input-align":"right"},null,8,["modelValue"]),Object(a["j"])(h,{title:e.personal.phone_linked?"已绑定手机号码":"未绑定手机号码",value:e.personal.phone_linked?e.personal.phone:"",onClick:t[3]||(t[3]=function(t){return e.showEditPhoneForm=!0})},null,8,["title","value"])]})),_:1}),Object(a["j"])("div",i,[Object(a["j"])(v,{class:"submit-button",type:"primary",size:"large",onClick:e.handleSubmit},{default:r((function(){return[u]})),_:1},8,["onClick"])]),Object(a["j"])(y,{class:"phone-form-overlay",show:e.showEditPhoneForm,onClick:t[5]||(t[5]=function(t){return e.showEditPhoneForm=!1})},{default:r((function(){return[Object(a["j"])("div",l,[Object(a["j"])("div",{class:"phone-form-body",onClick:t[4]||(t[4]=Object(a["S"])((function(){}),["stop"]))},[Object(a["j"])(g,{"submit-text":"确定修改",onSubmit:e.handlePhoneFormSubmit},null,8,["onSubmit"])])])]})),_:1},8,["show"])])})),b=(n("e7e5"),n("d399")),p=(n("96cf"),n("1da1")),f=(n("68ef"),n("a71a"),n("6e47")),d=(n("66b9"),n("b650")),j=(n("4056"),n("44bf")),h=(n("be7f"),n("565f")),O=(n("c194"),n("7744")),m=(n("0653"),n("34e9")),v=(n("5246"),n("6b41")),g=n("2af5"),y=n("4091"),k=n("0613"),w=n("99a7"),C=n("ea9b"),x=Object(a["k"])({name:"EditPersonal",components:{VanNavBar:v["a"],VanCellGroup:m["a"],VanCell:O["b"],VanField:h["b"],VanImage:j["a"],VanButton:d["a"],VanOverlay:f["a"],NavBarIcon:g["a"],PhoneForm:y["a"]},setup:function(){var e=Object(w["a"])(),t=e.personal;return{personal:t}},data:function(){return{temp:{name:"",intro:""},showEditPhoneForm:!1}},methods:{handleBack:function(){this.$router.back()},handlePhoneFormSubmit:function(e){var t=this;return Object(p["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=b["a"].loading("加载中..."),n.prev=1,n.next=4,Object(C["g"])(e);case 4:r=n.sent,n.next=12;break;case 7:return n.prev=7,n.t0=n["catch"](1),a.clear(),n.abrupt("return");case 12:t.personal=r.data,a.clear(),b["a"].success("修改成功"),t.showEditPhoneForm=!1;case 16:case"end":return n.stop()}}),n,null,[[1,7]])})))()},handleSubmit:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=b["a"].loading("加载中..."),t.prev=1,t.next=4,Object(C["g"])(e.temp);case 4:a=t.sent,t.next=12;break;case 7:return t.prev=7,t.t0=t["catch"](1),n.clear(),t.abrupt("return");case 12:e.personal=a.data,e.temp.name=e.personal.name,e.temp.intro=e.personal.intro,n.clear(),b["a"].success("修改成功");case 17:case"end":return t.stop()}}),t,null,[[1,7]])})))()}},created:function(){this.temp.name=this.personal.name,this.temp.intro=this.personal.intro},beforeRouteEnter:function(e,t,n){if(null===k["a"].state.user.personal)return b["a"].fail("请登录后操作"),void n({name:"Personal"});n()}});n("52ae");x.render=s,x.__scopeId="data-v-6be09ff6";t["default"]=x},fcc7:function(e,t,n){"use strict";n("b6aa")}}]);